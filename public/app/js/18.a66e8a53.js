(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{"8ef1":function(e,t,a){"use strict";var r=a("9ec8"),i=a.n(r);i.a},"9ec8":function(e,t,a){},"9fc6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"schedule-main q-pa-xl"},[a("div",{staticClass:"row",staticStyle:{"margin-bottom":"1em"}},[a("q-expansion-item",{staticClass:"filter",attrs:{"default-opened":"",icon:"fas fa-filter",label:"Filter"}},[a("div",{staticClass:"row q-gutter-md"},[a("q-input",{attrs:{clearable:"",label:"Loan ID"},on:{input:function(t){(e.filter.loan_id.length>=2&&/^\d+$/.test(e.filter.loan_id)||0===e.filter.loan_id.length)&&e.filterSchedule()}},model:{value:e.filter.loan_id,callback:function(t){e.$set(e.filter,"loan_id",t)},expression:"filter.loan_id"}}),a("q-input",{attrs:{clearable:"",label:"Borrower ID"},on:{input:function(t){(e.filter.borrower_id.length>=2&&/^\d+$/.test(e.filter.borrower_id)||0===e.filter.borrower_id.length)&&e.filterSchedule()}},model:{value:e.filter.borrower_id,callback:function(t){e.$set(e.filter,"borrower_id",t)},expression:"filter.borrower_id"}}),a("q-input",{attrs:{clearable:"",label:"Lender ID"},on:{input:function(t){(e.filter.lender_id.length>=2&&/^\d+$/.test(e.filter.lender_id)||0===e.filter.lender_id.length)&&e.filterSchedule()}},model:{value:e.filter.lender_id,callback:function(t){e.$set(e.filter,"lender_id",t)},expression:"filter.lender_id"}}),a("q-input",{attrs:{clearable:"",hint:"Exactly from this date",label:"Date From"},model:{value:e.filter.date_range.from,callback:function(t){e.$set(e.filter.date_range,"from",t)},expression:"filter.date_range.from"}},[a("q-popup-proxy",{ref:"dateFrom",attrs:{"transition-hide":"scale","transition-show":"scale"}},[a("q-date",{attrs:{mask:"DD-MM-YYYY"},on:{input:function(){e.$refs.dateFrom.hide(),e.filterSchedule()}},model:{value:e.filter.date_range.from,callback:function(t){e.$set(e.filter.date_range,"from",t)},expression:"filter.date_range.from"}})],1)],1),a("q-input",{attrs:{clearable:"",hint:"Exactly to this date",label:"Date To"},model:{value:e.filter.date_range.to,callback:function(t){e.$set(e.filter.date_range,"to",t)},expression:"filter.date_range.to"}},[a("q-popup-proxy",{ref:"dateTo",attrs:{"transition-hide":"scale","transition-show":"scale"}},[a("q-date",{attrs:{mask:"DD-MM-YYYY"},on:{input:function(){e.$refs.dateTo.hide(),e.filterSchedule()}},model:{value:e.filter.date_range.to,callback:function(t){e.$set(e.filter.date_range,"to",t)},expression:"filter.date_range.to"}})],1)],1),a("q-select",{attrs:{options:e.attempt_status_options,"emit-value":"",hint:"Status of attempt",label:"Status","map-options":""},on:{input:e.filterSchedule},model:{value:e.filter.attempted,callback:function(t){e.$set(e.filter,"attempted",t)},expression:"filter.attempted"}}),a("q-select",{attrs:{options:[{label:"",value:""},{label:"Repaid Loans",value:"repaid"}],"emit-value":"",hint:"Choose loan type",label:"Loan Type","map-options":""},on:{input:e.filterSchedule},model:{value:e.filter.loan_type,callback:function(t){e.$set(e.filter,"loan_type",t)},expression:"filter.loan_type"}})],1),a("div",{staticClass:"row",staticStyle:{"margin-top":"40px"}},[a("q-expansion-item",{staticClass:"col-sm-3",staticStyle:{color:"#979797"},attrs:{label:"Payback Date"}},[a("q-input",{attrs:{clearable:"",hint:"Exactly from this date",label:"Date From"},model:{value:e.filter.payback_date_range.from,callback:function(t){e.$set(e.filter.payback_date_range,"from",t)},expression:"filter.payback_date_range.from"}},[a("q-popup-proxy",{ref:"payback_dateFrom",attrs:{"transition-hide":"scale","transition-show":"scale"}},[a("q-date",{attrs:{mask:"DD-MM-YYYY"},on:{input:function(){e.$refs.payback_dateFrom.hide(),e.filterSchedule()}},model:{value:e.filter.payback_date_range.from,callback:function(t){e.$set(e.filter.payback_date_range,"from",t)},expression:"filter.payback_date_range.from"}})],1)],1),a("q-input",{attrs:{clearable:"",hint:"Exactly to this date",label:"Date To"},model:{value:e.filter.payback_date_range.to,callback:function(t){e.$set(e.filter.payback_date_range,"to",t)},expression:"filter.payback_date_range.to"}},[a("q-popup-proxy",{ref:"payback_dateTo",attrs:{"transition-hide":"scale","transition-show":"scale"}},[a("q-date",{attrs:{mask:"DD-MM-YYYY"},on:{input:function(){e.$refs.payback_dateTo.hide(),e.filterSchedule()}},model:{value:e.filter.payback_date_range.to,callback:function(t){e.$set(e.filter.payback_date_range,"to",t)},expression:"filter.payback_date_range.to"}})],1)],1)],1)],1)])],1),e.scheduleData.length?a("div",{staticClass:"row q-gutter-sm"},[a("json-excel",{staticClass:"col-sm-2",attrs:{data:e.scheduleData,fields:e.csv_fields,name:"Schedule.csv",type:"csv"}},[a("q-btn",{staticClass:"no-shadow",staticStyle:{"-webkit-border-radius":"2px","-moz-border-radius":"2px","border-radius":"2px"},attrs:{color:"secondary",icon:"fas fa-save",label:"Export Schedule","no-wrap":"",size:"sm",unelevated:""}})],1),a("json-excel",{staticClass:"col-sm-3",attrs:{data:e.toBePaidData,fields:e.to_be_paid_csv_fields,name:"ToBePaid.csv",type:"csv"}},[a("q-btn",{staticClass:"no-shadow",staticStyle:{"-webkit-border-radius":"2px","-moz-border-radius":"2px","border-radius":"2px"},attrs:{color:"secondary",unelevated:"",icon:"fas fa-save",label:"EXPORT ToBePaid","no-caps":"","no-wrap":"",size:"sm"}})],1),a("span",{staticClass:"col-sm-3"}),a("q-select",{staticClass:"col-sm-2",staticStyle:{"margin-top":"0","font-size":"12px"},attrs:{options:[{label:"50 per page",value:"50"},{label:"100 per page",value:"100"},{label:"200 per page",value:"200"},{label:"500 per page",value:"500"},{label:"1000 per page",value:"1000"}],"emit-value":"","map-options":"",dense:""},on:{change:function(t){return e.filterSchedule()}},model:{value:e.filter.per_page,callback:function(t){e.$set(e.filter,"per_page",t)},expression:"filter.per_page"}}),a("q-space"),a("span",{staticStyle:{"font-weight":"lighter",color:"gray","font-size":"12px","padding-top":"14px"}},[e._v(e._s(e.entries.to)+" out of\n                    "+e._s(e.entries.total))])],1):e._e(),a("div",{staticClass:"row justify-center",staticStyle:{"margin-top":"30px"}},[e.scheduleData.length>0?a("table",{staticClass:"q-table loose"},[a("thead",[a("tr",[a("th",[e._v("INS")]),a("th",[e._v("LOAN ID")]),a("th",[e._v("BORR. ID")]),""===e.filter.lender_id?a("th",[e._v("AMOUNT")]):a("th",[e._v("AMT.")]),""!==e.filter.lender_id?a("th",[e._v("PAYABLE")]):e._e(),""!==e.filter.lender_id?a("th",[e._v("INV. AMT")]):e._e(),a("th",[e._v("ATTEMPTS")]),a("th",[e._v("STATUS")]),a("th",[e._v("DATE")])])]),a("tbody",e._l(e.scheduleData,(function(t,r){return a("tr",{style:{"background-color":1==t.success?"#e5f1e6":"ACK"===t.await||t.percent_paid>0?"#fff1df":t.attempts>0&&0==t.percent_paid?"#fbe9e7":""}},[a("td",{staticClass:"text-center"},[e._v("#"+e._s(t.installment))]),a("td",{staticClass:"text-center",attrs:{title:"Click to navigate to loan details"},on:{click:function(a){return e.gotoLoan(t.loan_id)}}},[e._v(" "+e._s(t.loan_id)+"\n                    ")]),a("td",{staticClass:"text-center",attrs:{title:"Click to navigate to borrower details"},on:{click:function(a){return e.gotoBorrower(t.borrower_id)}}},[e._v(e._s(t.borrower_id)+"\n                    ")]),a("td",{staticClass:"text-center"},[e._v("₦"+e._s(e._f("formatAmount")(t.amount)))]),""!==e.filter.lender_id?a("td",{staticClass:"text-center"},[e._v("₦"+e._s(e._f("formatAmount")(t.lender_payable))+"\n                    ")]):e._e(),""!==e.filter.lender_id?a("td",{staticClass:"text-center"},[e._v("₦"+e._s(e._f("formatAmount")(t.amt_invested))+"\n                    ")]):e._e(),a("td",{staticClass:"text-center"},[e._v(e._s(t.attempts))]),a("td",{staticClass:"text-center",style:{"font-size":"12px","font-weight":"bold",color:1==t.success?"#4CAF50":"ACK"===t.await||t.attempts>0&&t.percent_paid>0?"#FF6F00":t.attempts>0&&0==t.percent_paid||e.$moment(t.set_date)<e.$moment()?"#BF360C":"#9E9E9E"}},[e._v("\n                        "+e._s(t.success?e.$moment(t.date_paid).format("MMM Do, YYYY"):"ACK"===t.await?"ACK":t.attempts>0&&t.percent_paid>0?t.percent_paid+"% (₦"+e.formatAmount(t.percent_paid_computed)+")":t.attempts>0&&0==t.percent_paid?"FAILED":e.$moment(t.set_date)<e.$moment()?"DUE":"PENDING")+"\n                    ")]),a("td",{staticClass:"text-center"},[e._v(e._s(e._f("moment")(t.set_date,"MMM Do, YYYY")))])])})),0)]):e._e()]),e.scheduleData.length<e.entries.total?a("div",{staticClass:"row justify-center"},[a("q-infinite-scroll",{attrs:{handler:e.refresher,offset:500}},[a("q-spinner-puff",{staticStyle:{"margin-top":"30px"},attrs:{slot:"message",size:40,color:"primary"},slot:"message"})],1)],1):e._e()])},i=[],n=(a("8e6e"),a("8a81"),a("456d"),a("6b54"),a("a481"),a("4db1")),o=a.n(n),s=(a("ac6a"),a("cadf"),a("06db"),a("967e")),l=a.n(s),c=a("c47a"),d=a.n(c),f=(a("96cf"),a("fa84")),p=a.n(f),u=a("b178"),_=a("1bdd");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){d()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"Schedule",meta:function(){return{title:"Schedule"}},components:{JsonExcel:_["a"]},data:function(){return{activeNames:["1"],filter:{loan_id:this.$route.query.loan_id,borrower_id:"",lender_id:"",date_range:{from:"",to:""},attempted:"",loan_type:"",payback_date_range:{from:"",to:""},page:1,per_page:"100"},scheduleData:[],toBePaidData:[],text:"",csv_fields:{Investment:"installment","Loan ID":"loan_id","Borrower ID":"borrower_id","Borrower First Name":"borrower.f_name","Borrower Last Name":"borrower.l_name","Borrower Email":"borrower.email","Borrower Phone":"borrower.phone","Investor Info":{field:"lender",callback:function(e){var t="";return e.forEach((function(e){t+="".concat(e.id," - ").concat(e.f_name," ").concat(e.l_name,"; ")})),t}},"Repayment Info":{field:"repayment_info",callback:function(e){var t="";return e.length&&e.forEach((function(e){t+="ID ".concat(e.to_who," - #").concat(e.amount," ").concat(e.date_of_last_attempt,"; ")})),t}},Amount:"amount",Payable:"lender_payable","Amt. Invested":"amt_invested",Attempts:"attempts",Success:"success","Amount Paid":"percent_paid_computed","Percent Paid":"percent_paid","Payback Date":"set_date","Date Paid":"date_paid"},to_be_paid_csv_fields:{ID:"id",Amount:"amount","Date Added":"date_added","Recipient ID":"to_who","Recipient First Name":"recipient.f_name","Recipient Last Name":"recipient.l_name",Success:"success","Date Paid":"date_of_last_attempt","Loan ID":"related_loan"},entries:{to:"",total:""},minFilterLength:3,attempt_status_options:[{label:"",value:""},{label:"Successful",value:"success"},{label:"Failed",value:"failed"},{label:"Pending",value:"pending"},{label:"Due",value:"due"},{label:"Acknowledged",value:"ack"}]}},computed:{},mounted:function(){this.$route.query.loan_id&&this.filterSchedule()},methods:{exportData:function(){var e=this;return p()(l.a.mark((function t(){var a;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("schedule/filter",{params:h({export:!0},e.filter)});case 2:return a=t.sent,t.abrupt("return",a.data);case 4:case"end":return t.stop()}}),t)})))()},fetchSchedule:function(){this.$axios.get("schedule/fetch").then(function(e){this.scheduleData=e.data.data,this.entries.to=e.data.to,this.entries.total=e.data.total}.bind(this)).catch(function(e){console.error(e)}.bind(this))},refresher:function(e,t){this.filter.page++,this.$axios.get("schedule/filter",{params:this.filter}).then(function(e){var a;(a=this.scheduleData).push.apply(a,o()(e.data.data)),this.entries.to=e.data.to,this.entries.total=e.data.total,t()}.bind(this)).catch(function(e){t(),console.error(e)}.bind(this))},filterSchedule:Object(u["e"])((function(){this.filter.page=1,this.$axios.get("schedule/filter",{params:this.filter}).then(function(e){this.scheduleData=e.data.paybacks.data,this.entries.to=e.data.paybacks.to,this.entries.total=e.data.paybacks.total,this.toBePaidData=e.data.to_be_paid}.bind(this)).catch(function(e){console.error(e)}.bind(this))}),1e3),gotoLoan:function(e){this.$router.push({path:"loans",query:{id:e}})},gotoBorrower:function(e){this.$router.push({path:"borrowers",query:{id:e}})},refreshEntries:function(){this.resetFilterData(),this.fetchSchedule()},resetFilterData:function(){this.filter.lender_id="",this.filter.f_name="",this.filter.l_name="",this.filter.username="",this.filter.phone="",this.filter.email=""},showAlert:function(e,t){this.$q.notify({type:e,message:t,position:"top-right",timeout:4e3})},firstCaps:function(e){if(null!=e)return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},formatAmount:function(e){return isNaN(e)?e:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},filters:{firstCaps:function(e){if(null!=e)return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},formatAmount:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}}},g=b,v=(a("8ef1"),a("2877")),y=Object(v["a"])(g,r,i,!1,null,"40a41735",null);t["default"]=y.exports}}]);